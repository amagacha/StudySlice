<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>StudySlice</title>

  <!-- ===== CSSï¼ˆç›´æ›¸ãï¼‰ ===== -->
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    .card {
      background: white;
      padding: 15px;
      margin: 15px auto;
      max-width: 420px;
      border-radius: 8px;
    }

    input, button {
      width: 100%;
      margin-top: 6px;
      padding: 8px;
      box-sizing: border-box;
    }

    button {
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #watch {
      font-size: 32px;
      text-align: center;
    }

    ul {
      padding-left: 0;
    }

    li {
      list-style: none;
      margin-bottom: 4px;
    }
  </style>
</head>

<body>

<h1>ğŸ“˜ StudySlice</h1>

<!-- ãƒ­ã‚°ã‚¤ãƒ³ -->
<div class="card">
  <input id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
  <button onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
  <p id="userLabel"></p>
</div>

<!-- ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒ -->
<div class="card">
  <h2>â± ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒ</h2>
  <p id="watch">00:00</p>
  <button onclick="startWatch()">é–‹å§‹</button>
  <button onclick="stopWatch()">åœæ­¢</button>
  <button onclick="resetWatch()">ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<!-- å‹‰å¼·å…¥åŠ› -->
<div class="card">
  <input id="subject" placeholder="ç§‘ç›®">
  <input id="time" type="number" placeholder="åˆ†">
  <button onclick="addLog()">è¨˜éŒ²</button>
</div>

<!-- AI -->
<div class="card">
  <h2>ğŸ¤– AIå­¦ç¿’ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h2>
  <button onclick="generateAdvice()">ç”Ÿæˆ</button>
  <p id="advice"></p>
</div>

<!-- ã‚°ãƒ©ãƒ• -->
<div class="card">
  <h2>ğŸ“Š å­¦ç¿’ã‚°ãƒ©ãƒ•</h2>
  <canvas id="chart" width="300" height="200"></canvas>
</div>

<!-- ãƒ­ã‚° -->
<div class="card">
  <h2>ğŸ“… å‹‰å¼·ãƒ­ã‚°</h2>
  <ul id="logList"></ul>
  <p id="totalTime"></p>
  <button onclick="resetLogs()">å…¨ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<!-- ===== JavaScriptï¼ˆç›´æ›¸ãï¼‰ ===== -->
<script>
  /* ---------- ãƒ­ã‚°ä¿å­˜ ---------- */
  function getLogs() {
    return JSON.parse(localStorage.getItem("logs")) || [];
  }

  function saveLog(log) {
    const logs = getLogs();
    logs.push(log);
    localStorage.setItem("logs", JSON.stringify(logs));
  }

  function clearLogs() {
    localStorage.removeItem("logs");
  }

  /* ---------- ãƒ­ã‚°ã‚¤ãƒ³ ---------- */
  function login() {
    const name = document.getElementById("username").value;
    localStorage.setItem("user", name);
    document.getElementById("userLabel").textContent = "ğŸ‘¤ " + name;
  }

  const savedUser = localStorage.getItem("user");
  if (savedUser) {
    document.getElementById("userLabel").textContent = "ğŸ‘¤ " + savedUser;
  }

  /* ---------- ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒ ---------- */
  let seconds = 0;
  let timer = null;

  function updateWatch() {
    const m = String(Math.floor(seconds / 60)).padStart(2, "0");
    const s = String(seconds % 60).padStart(2, "0");
    document.getElementById("watch").textContent = m + ":" + s;
  }

  function startWatch() {
    if (timer) return;
    timer = setInterval(() => {
      seconds++;
      updateWatch();
    }, 1000);
  }

  function stopWatch() {
    clearInterval(timer);
    timer = null;
  }

  function resetWatch() {
    stopWatch();
    seconds = 0;
    updateWatch();
  }

  /* ---------- å‹‰å¼·ãƒ­ã‚° ---------- */
  function addLog() {
    const subject = document.getElementById("subject").value;
    const time = Number(document.getElementById("time").value);

    if (!subject || time <= 0) return;

    saveLog({
      subject,
      time,
      date: new Date().toLocaleDateString()
    });

    document.getElementById("subject").value = "";
    document.getElementById("time").value = "";

    render();
  }

  function resetLogs() {
    clearLogs();
    render();
  }

  /* ---------- AI ---------- */
  function generateAdvice() {
    const logs = getLogs();
    const total = logs.reduce((s, l) => s + l.time, 0);

    let msg = "å°‘ã—ãšã¤ã§OK";
    if (total > 300) msg = "ã„ã„ãƒšãƒ¼ã‚¹ï¼";
    if (total > 600) msg = "åŠªåŠ›é‡ãŒç•°å¸¸ã€å¤©æ‰";

    document.getElementById("advice").textContent = msg;
  }

  /* ---------- ã‚°ãƒ©ãƒ• ---------- */
  function drawChart(logs) {
    const canvas = document.getElementById("chart");
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, 300, 200);

    const totals = {};
    logs.forEach(l => {
      totals[l.date] = (totals[l.date] || 0) + l.time;
    });

    let i = 0;
    Object.values(totals).forEach(v => {
      ctx.fillRect(i * 40 + 10, 200 - v, 30, v);
      i++;
    });
  }

  /* ---------- è¡¨ç¤º ---------- */
  function render() {
    const logs = getLogs();
    const list = document.getElementById("logList");
    const totalEl = document.getElementById("totalTime");

    list.innerHTML = "";
    let total = 0;

    logs.forEach(l => {
      total += l.time;
      const li = document.createElement("li");
      li.textContent = `${l.date}ï½œ${l.subject}ï¼š${l.time}åˆ†`;
      list.appendChild(li);
    });

    totalEl.textContent = "åˆè¨ˆï¼š" + total + "åˆ†";
    drawChart(logs);
  }

  render();
</script>

</body>
</html>
